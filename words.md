各位朋友大家好，今天我们继续学习pg

在数据库体系中，事务是最核心、最复杂的技术

如果没有事务，数据库就只是一个普通的数据文件，无法保证数据安全，更无法支撑并发的业务系统

事务定义了数据库的可靠性边界

我们过去关于事务的学习过于碎片化，理论上的事务四大特性背的比较熟悉，也知道一点MVCC，锁等各种行业术语，但是始终没有把二者联系起来看，为什么要mvcc，为什么要wal

什么又是一致性。我们今天做个简单的分析，说明一下事务的四大特性和PG中实现相关特性依赖的技术

事务的四大特性分别是隔离性、持久性、原子性和一致性

其中持久性、原子性和一致性其实可以看作是对于单个事务的基本要求

但是数据库必须支持并发，那么对于并发中事务之间的可见性要求有隔离性这个特性来说明，也正因并发的复杂性，导致了认识和学习隔离性的复杂

标准规定了多种隔离级别，本质是定义了一致性和效率的权衡，如果要极致的效率就必须采用较低的隔离级别，反之若要追求较强一致性时，就必须更高的隔离级别定义事务之间影响的边界

这和分布式场景中的CAP权衡如出一辙，只不过单机不用考虑P，单纯的C和A之间的进一步权衡取舍

接下来我们说明一下事务四大特性的主流实现方式

隔离性的主流实现方式是MVCC和各种锁机制互相配合，这也是我们之前分享的页面中元组保存事务信息的重要原因

持久性的主流实现方式是WAL，在写入数据前首先写入日志，保留了操作记录的同时，用顺序写提高写入效率

将wal发挥到极致，将日志作为第一公民的最终形态就是LSM tree

原子性在pg中由Clog和WAL等配合实现，一个事务只有Clog状态更新完成才视为完成，否则即便做完99%的工作，没有提及也相当于没做

一致性与其说是一种特性，更像是一种要求，要求数据库在事务前后的状态是正确的、完整的、符合数据操作语义的，除了前面说的AID外还有各种约束、索引、列属性、列类型等共同保障

这里还有一些文档介绍相关的理论和实现，可以作为参考

这就是我们今天分享的关于事务及其实现方式的相关内容，接下来我们会持续学习事务隔离性相关内容，待理论准备好之后再来学习PG源码

那我们今天的内容就到这里，感谢朋友们的支持，我们下期再见吧。